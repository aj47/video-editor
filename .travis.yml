jobs:
  include:
    - os: osx
      osx_image: xcode11.2
      language: node_js
      node_js: "12"
      env:
        - ELECTRON_CACHE=$HOME/.cache/electron
        - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

    - os: linux
      services: docker
      language: generic

cache:
  directories:
    - node_modules
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder

script:
  - |
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      docker run --rm \
        -v ${PWD}:/project \
        -v ~/.cache/electron:/root/.cache/electron \
        -v ~/.cache/electron-builder:/root/.cache/electron-builder \
        electronuserland/builder:wine \
        /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn build --win"
    else
      yarn build
    fi
before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine
  - sudo chown -R travis:travis $HOME/.cache/electron
  - sudo chown -R travis:travis $HOME/.cache/electron-builder

deploy:
  provider: releases
  api_key:
    secure: 0cP0ee+H/2gRxt8fS0xr7oQm3ptO/UHq0gBB52LCn1qBKvc1CJODyFyJmftLaYoh7s7uifVGrNdLEiuxDPFFQYEy3nNBab4j8vnF7em3cUdGcQE96cHHKEZzlaiPIc7wrOIAy2dlqUO/4N4D6FRfTmugvXzlVIbOwVWT660nvrJ/vJsZHR+mOh9Q3KAnLVPowtfSwgA1HidqWy8wDTlXmqVu5i0pySm8WIaUztxCkSg5fShZM2QAtwNI1zpw3B/BvHckALFOF94D6v2Umkhi1hYxK5G80DP4l6CdcsIPDWL9AVyjSaaYQpnl4diftTiJ/xFHzQ2VCc/F3d47IzuOtYsL16553QODgFpWHrevTLznnu2TwFespsT/R9G4TRUchp0arKgFuLBV5HRrzkulEDRwTYUIRTXBt6vZVgTc4Tek1TCbeuHhT2+mpx2eNlr7+dWHxCKBnXf5qsfpSKUPuwSJ0Alsy6XCDObwpBmuFCU2pH2UfCDo7G9hYOQXFNUku4UKaISsd6ibO3gmAoq9k9RDRbJpQjDnk8Ef93aJWiC0fUw3EgNnbfqUFHG2EfsPDtWKAvnua6YabpO3PvVDktB68RzkwyaVxiPbz9sIiDCJeHdAzAaFvoC12wf+h5RV+vRh8fQd/rPHpW+6yPgLl95Z+8GopxTHLblgiV/ybkk=
  file_glob: true
  file:
    - dist/Gifizer-*-mac.dmg
    - dist/Gifizer-*-win.exe
    - dist/Gifizer-*-win.zip
  on:
    tags: true
    branch: master
    repo: kyushun/gifizer
